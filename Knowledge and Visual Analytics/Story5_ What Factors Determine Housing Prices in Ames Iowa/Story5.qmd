---
title: "Story - 5 : What Factors Determine Housing Prices in Ames Iowa"
Author: Jiaxin Zheng
format: 
  revealjs:
    theme: simple
    slide-number: true
    toc: false
    center-title-slide: true
    transition: slide
execute:
  echo: false
  warning: false
  message: false
---

```{r}
library(tidyverse)
library(ggplot2)
library(marginaleffects)
library(reshape2)
library(RColorBrewer)
```

```{r}
train <- read.csv("https://raw.githubusercontent.com/Jennyjjxxzz/Data-608_Story_5/refs/heads/main/train.csv")

```


```{r}

# Replace NA in numeric columns with mean
train_clean <- train %>%
  mutate(across(where(is.numeric), ~ ifelse(is.na(.), mean(., na.rm = TRUE), .))) %>%
  mutate(across(where(is.numeric), ceiling))  # Round up all numeric values
```


```{r}

# Select relevant variables for EDA
df <- train_clean %>%
  select(SalePrice, GrLivArea, LotArea, OverallQual, GarageCars, GarageArea,
         KitchenQual, SaleType, Neighborhood, YearBuilt) %>%
  mutate(

    KitchenQual = recode(KitchenQual,
                         "Po" = "Poor",
                         "Fa" = "Fair",
                         "TA" = "Typical",
                         "Gd" = "Good",
                         "Ex" = "Excellent"),
    
    # Set the new order of levels
    KitchenQual = factor(KitchenQual, levels = c("Poor", "Fair", "Typical", "Good", "Excellent")),
    
    SaleType = as.factor(SaleType),
    Neighborhood = as.factor(Neighborhood)
  )

```

## Understanding the Data
```{r}
#| eval: True
summary(df)
```
## What’s Most Correlated with Price?

- Overall quality(0.79) is the strongest correlated with house price. 
- Fellow by GrLiveArea(0.71)
```{r}

# Select variables
vars <- c("SalePrice", "GrLivArea", "LotArea", "OverallQual", "GarageCars", "GarageArea", "YearBuilt")
cor_data <- cor(df[, vars])

# matrix into long format
cor_melt <- melt(cor_data)

corr<- ggplot(cor_melt, aes(x = Var1, y = Var2, fill = value)) +
  geom_tile(color = "white") +
  geom_text(aes(label = round(value, 2)), size = 4) +
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                       midpoint = 0.5, limit = c(0,1), space = "Lab", 
                       name="Correlation") +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))

corr
```


```{r}
# Fit linear regression model
model <- lm(SalePrice ~ GrLivArea + LotArea + OverallQual + GarageCars +
              GarageArea + YearBuilt + KitchenQual + SaleType + Neighborhood,
            data = df)
```

## Predicted Prices by Sale Type
- New construction and contract(Con) are predicted to sell for more.
```{r}
# Compare predicted sale price across Sale Types
plot1 <- plot_predictions(model, condition = "SaleType") +
  labs(title = "Predicted Sale Price by Sale Type")

plot1
```

## Kitchen Quality Makes a Big Difference
- Excellent kitchen quality sales for more price.
- From "Poor" to "Excellent", the price jump is more than $50,000 difference in between.

```{r}

plot2 <- plot_predictions(model, condition = "KitchenQual", newdata = df) +
  labs(title = "Predicted Sale Price by Kitchen Quality")

plot2
```



## Neighborhood Really Matters
- Top three neighborhood are 1. NoRidge, 2. StoneBr, 3. NridgHt

```{r}
library(broom)

# use tidy for locations
tidy_model <- tidy(model, conf.int = TRUE)

plot3 <- tidy_model %>%
  filter(str_detect(term, "Neighborhood")) %>%
  mutate(term = str_remove_all(term, "Neighborhood")) %>%
  ggplot(aes(x = reorder(term, estimate), y = estimate,
             ymin = conf.low, ymax = conf.high)) +
  geom_pointrange() +
  coord_flip() +
  labs(title = "Neighborhood Effect on Housing Price in Ames",
       y = "Effect on Sale Price (USD)", x = "Neighborhood")+
  theme_minimal(base_size = 12)


plot3
```




## Conclusion: What Drives Price in Ames?
- Quality and size matter — especially Overall Quality, large Living Area, and Kitchen Quality makes house sale higher.
- A house with a poor kitchen doesn't sell as well as an excellent kitchen.
- Location matters- Top three neighborhood are 1. NoRidge, 2. StoneBr, 3. NridgHt



